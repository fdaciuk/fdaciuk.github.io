<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>WordPress - Criando um formulário de contato sem plugin - Parte 2 | Da2k Blog</title>
  <link rel="author" href="//plus.google.com/+FernandoDaciuk">
  
  <meta name="description" content="No post anterior, montamos nossa view, com os campos do formulário, e deixamos preparada a interface que irá receber o retorno do envio.Hoje nós veremos como a view receberá as informações que ela precisa, mantendo a ordem dos nossos arquivos :D">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="WordPress - Criando um formulário de contato sem plugin - Parte 2"/>
  <meta property="og:site_name" content="Da2k Blog"/>

  
    <meta property="og:image" content="http://blog.da2k.com.br/uploads/2015/02/wordpress-form-without-plugin2.png" />
  

  <meta property="og:url" content="http://blog.da2k.com.br/2015/02/24/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-2/" />

  
    <meta name="google-site-verification" content="GDAVmZEJwsAq3Cv0Uk8BJNicEJCOkmYOqFxQKtR8RAw" />
  

  <link href="http://blog.da2k.com.br/favicon.png" rel="shortcut icon">
  <link rel="alternate" href="/atom.xml" title="Da2k Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26050978-1']);
  _gaq.push(['_setDomainName', 'da2k.com.br']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1>
    <a class="brand" href="/">
        
          <img src="/images/logo-blog.svg" width="210" height="80" title="Da2k Blog" />
        
    </a>
  </h1>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/cursos">Cursos</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-02-24T00:00:00.000Z"><a href="/2015/02/24/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-2/">24 de fevereiro de 2015</a></time>
      
      
  
    <h1 class="title">WordPress - Criando um formulário de contato sem plugin - Parte 2</h1>
  

    </header>
    <div class="entry">
      
        <p><img src="http://blog.da2k.com.br/uploads/2015/02/wordpress-form-without-plugin2.png" alt=""></p>
<p>No <a href="http://blog.da2k.com.br/2015/02/22/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-1/" target="_blank" rel="external">post anterior</a>, montamos nossa <em>view</em>, com os campos do formulário, e deixamos preparada a interface que irá receber o retorno do envio.<br>Hoje nós veremos como a <em>view</em> receberá as informações que ela precisa, mantendo a ordem dos nossos arquivos :D</p>
<a id="more"></a>

<h2 id="Criando_nosso_controller">Criando nosso controller</h2>
<p>Primeiramente, como temos uma página nova, vamos criar um controller que irá gerenciar todas as informações para essa página. No momento, temos só um formulário de contato. Mas poderíamos ter informações de contato, endereço, etc., em uma sidebar. Então já vamos deixar nossa aplicação escalável, separando corretamente as responsabilidades.</p>
<p>Crie um novo arquivo chamado <code>controller-contact.php</code> em <code>functions/controllers</code>, e vamos gerar o código padrão para o nosso <em>controller</em>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">'/../security.php'</span>;</div><div class="line">  </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Controller_Contact</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>{</div><div class="line">        add_filter( <span class="string">'send_contact_form'</span>, <span class="keyword">array</span>( <span class="keyword">new</span> Service_Contact_Form, <span class="string">'send_contact_form'</span> ) );</div><div class="line">    }</div><div class="line">}</div><div class="line">  </div><div class="line"><span class="keyword">new</span> Controller_Contact;</div></pre></td></tr></table></figure>

<p>Usamos a mesma base utilizada para criar nosso <code>controller-single.php</code>. </p>
<p><em>Hey, o que é aquele <code>new Service_Contact_Form</code>?</em></p>
<p>Como eu disse acima, vamos separar as responsabilidades das coisas. Se o <em>controller</em> ficar responsável por tratar os dados e exibí-los por toda a nossa página, quanto mais informações tivermos, maior ficará nosso arquivo, e pior para dar manutenção. Então vamos utilizar <em>services</em> que nos ajudarão a organizar o código.</p>
<p>Os <em>services</em> basicamente servirão para tratar todas a parte “bruta” do código. Cada <em>service</em> terá uma única responsabilidade. Nesse caso, o <code>Service_Contact_Form</code> servirá somente para tratar os dados de envio do nosso formulário. Se houver a necessidade de exibir informações de contato na sidebar, então nós iremos criar outro <em>service</em> para isso.</p>
<p>Os <code>controllers</code> podem chamar quantos <em>services</em> forem necessários. Por isso nós iremos criar um <em>controller</em> por página, e quantos services forem necessários, para cada <em>controller</em>. </p>
<p>Agora, explicando a chamada acima:</p>
<p>Você deve lembrar que, no artigo que falamos sobre <a href="http://blog.da2k.com.br/2015/02/11/wordpress-controlando-a-exibicao-dos-dados/" target="_blank" rel="external">controlar a exibição dos dados</a> na nossa <em>single</em>, usamos um <code>array</code>, e passamos como primeiro parâmetro o <code>$this</code>, que é a referência para o objeto instanciado à partir daquela classe. Agora, nós estamos usando outra classe, chamada <code>Service_Contact_Form</code>. Por isso, instanciamos ela, e passamos como segundo parâmetro o método que nós esperamos que ela nos retorne os dados, para que sejam enviados à view, no momento em que o <em>hook</em> <code>send_contact_form</code> for ativado.</p>
<p>Esse <em>hook</em> está no início da nossa <em>view</em>, como vimos no <a href="http://blog.da2k.com.br/2015/02/22/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-1/" target="_blank" rel="external">post anterior</a>.</p>
<p>Ficou claro até aqui? Vamos seguir então :)</p>
<p>Agora vamos criar nosso <em>service</em>. Crie um diretório <code>service</code> dentro do diretório <code>functions/</code>, e, dentro desse diretório, crie o arquivo <code>service-contact-form.php</code>.</p>
<p>Antes de continuarmos, precisamos incluir nossos arquivos para que eles possam ser utilizados na nossa aplicação. Até aqui, o início do nosso <code>functions.php</code> está assim:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">'/functions/security.php'</span>;</div><div class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">'/functions/controllers/controller-single.php'</span>;</div></pre></td></tr></table></figure>

<p>Vamos adicionar nosso <em>controller</em> da página de contato e também o <em>service</em>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">'/functions/security.php'</span>;</div><div class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">'/functions/services/service-contact-form.php'</span>;</div><div class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">'/functions/controllers/controller-single.php'</span>;</div><div class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">'/functions/controllers/controller-contact.php'</span>;</div></pre></td></tr></table></figure>

<p>É muito importante a ordem que você inclui suas classes. No nosso caso, vamos sempre chamar os <em>services</em> <strong>antes</strong> dos <em>controllers</em>. Não é necessário manter uma ordem entre os <em>services</em>, ou entre os <em>controllers</em>, pois um <em>service</em> nunca consultará outro <em>service, igualmente um _controller</em> nunca consultará outro <em>controller</em>.</p>
<p>Agora, vamos começar a criar nosso <em>service</em>. Em <code>functions/services/service-contact-form.php</code>, adicione o seguinte código:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line"><span class="keyword">require_once</span> <span class="keyword">__DIR__</span> . <span class="string">'/../security.php'</span>;</div><div class="line">  </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Service_Contact_Form</span> </span>{</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">send_contact_form</span><span class="params">()</span> </span>{</div><div class="line">        <span class="keyword">return</span> (object) <span class="keyword">array</span>(</div><div class="line">            <span class="string">'status'</span> =&gt; <span class="string">'success'</span>,</div><div class="line">            <span class="string">'message'</span> =&gt; <span class="string">'Seu e-mail foi enviado com sucesso!'</span></div><div class="line">        );</div><div class="line">    }</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Antes de qualquer coisa, precisamos testar se tudo funciona, então, por enquanto, vamos somente retornar os dados necessários à nossa interface.</p>
<div class="ads-da2k"><a href="http://www.eventick.com.br/curso-javascript-ninja" target="_blank"><img src="https://cloud.githubusercontent.com/assets/487669/6239059/58b94ab0-b6e7-11e4-8e5d-a5f2740870fd.png" alt="CURSO NINJA JAVASCRIPT - INSCREVA-SE JÁ!"></a></div>

<p><em>O que tem de diferente nesse arquivo?</em> </p>
<p>Nosso controller espera um método chamado <code>send_contact_form</code>, dentro da classe <code>Service_Contact_Form</code>, para enviar os dados à nossa <em>view</em>.</p>
<p>Na <em>view</em>, nós esperamos que a resposta seja um objeto, com as propriedades <code>status</code> e <code>message</code>. Por isso estamos retornando esse valor no nosso método.</p>
<p><em>Por que aquele <code>(object)</code> ali?</em></p>
<p>Estava esperando você perguntar! :)</p>
<p>Como você pode perceber, nosso método retorna um <code>array</code>, mas nossa <em>view</em> espera que o retorno seja um objeto. Além da classe <code>StdClass()</code>, que instancia uma nova classe vazia em PHP, para que você crie seus próprios métodos e propriedades rapidamente, podemos usar esse formato para converter um <code>array</code> para objeto.</p>
<p>Dessa forma, poderemos acessar corretamente esses dados na <em>view</em>, com:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$post_response</span><span class="variable">-&gt;status</span>; <span class="comment">// "success"</span></div><div class="line"><span class="variable">$post_response</span><span class="variable">-&gt;message</span>; <span class="comment">// "Seu e-mail foi enviado com sucesso!"</span></div></pre></td></tr></table></figure>

<p>Agora é o momento de você usar a sua criatividade e usar CSS para estilizar a mensagem, para que ela fique “apresentável” ao usuário final :) </p>
<p>Teste mensagens com muito texto, com pouco texto, mude o status para <code>error</code> para saber como deve ser mostrada uma mensagem de erro. Nos próximos artigos continuaremos nossa saga para tratar os dados inputados pelo usuário, tratar algumas regras de segurança, para enfim fazer o envio do e-mail! Não perca os próximos episódios :D</p>
<p>Até lá!</p>
<p>Ficou alguma dúvida? Comente! :)</p>
<blockquote>

<p><strong>Link para o índice dessa série: </strong><br><a href="http://blog.da2k.com.br/2015/01/11/indice-da-serie-como-criar-temas-para-wordpress/" target="_blank" rel="external">http://blog.da2k.com.br/2015/01/11/indice-da-serie-como-criar-temas-para-wordpress/</a></p>
<p><strong> Post anterior:</strong><br><a href="http://blog.da2k.com.br/2015/02/22/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-1/" target="_blank" rel="external">http://blog.da2k.com.br/2015/02/22/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-1/</a></p>
<p><strong> Próximo post:</strong><br><a href="">EM BREVE!</a></p>
</blockquote>


<blockquote>
<p>Sobre o #1postperday: <a href="http://blog.da2k.com.br/2014/12/31/um-post-por-dia/" target="_blank" rel="external">http://blog.da2k.com.br/2014/12/31/um-post-por-dia/</a></p>
<p>Tem alguma sugestão para os próximos posts do #1postperday? Deixe ela aqui: <a href="https://github.com/fdaciuk/fdaciuk.github.io/issues/1" target="_blank" rel="external">https://github.com/fdaciuk/fdaciuk.github.io/issues/1</a></p>
</blockquote>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/wordpress/">wordpress</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/1postperday/">1postperday</a>, <a href="/tags/serie-temas-wordpress/">serie temas wordpress</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count" addthis:url="http://blog.da2k.com.br/2015/02/24/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-2/"></a>
    
    
      <a class="addthis_button_tweet" addthis:url="http://blog.da2k.com.br/2015/02/24/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-2/"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium" addthis:url="http://blog.da2k.com.br/2015/02/24/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-2/"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal" addthis:url="http://blog.da2k.com.br/2015/02/24/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-2/"></a>
    
    <a class="addthis_counter addthis_pill_style" addthis:url="http://blog.da2k.com.br/2015/02/24/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-2/"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>


      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<section id="comment">
  <h1 class="title">Comments</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action=""
    method="get"
    data-action="https://google.com.br/search?q=site:blog.da2k.com.br"
    accept-charset="utf-8"
    data-js="google-search-form">
    <input type="search" name="q" results="0" placeholder="Search" data-js="google-search-input">
  </form>
</div>


  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/css/">css</a><small>2</small></li>
  
    <li><a href="/categories/frontend/">frontend</a><small>1</small></li>
  
    <li><a href="/categories/git/">git</a><small>1</small></li>
  
    <li><a href="/categories/github/">github</a><small>13</small></li>
  
    <li><a href="/categories/html/">html</a><small>2</small></li>
  
    <li><a href="/categories/javascript/">javascript</a><small>26</small></li>
  
    <li><a href="/categories/markdown/">markdown</a><small>1</small></li>
  
    <li><a href="/categories/wordpress/">wordpress</a><small>12</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/1postperday/">1postperday</a><small>55</small></li>
  
    <li><a href="/tags/amd/">amd</a><small>2</small></li>
  
    <li><a href="/tags/bdd/">bdd</a><small>1</small></li>
  
    <li><a href="/tags/braches/">braches</a><small>1</small></li>
  
    <li><a href="/tags/chrome-extension/">chrome extension</a><small>1</small></li>
  
    <li><a href="/tags/clean-code/">clean code</a><small>2</small></li>
  
    <li><a href="/tags/code-coverage/">code coverage</a><small>1</small></li>
  
    <li><a href="/tags/commonjs/">commonjs</a><small>1</small></li>
  
    <li><a href="/tags/coverage/">coverage</a><small>1</small></li>
  
    <li><a href="/tags/debug/">debug</a><small>1</small></li>
  
    <li><a href="/tags/debugger/">debugger</a><small>1</small></li>
  
    <li><a href="/tags/deploy/">deploy</a><small>1</small></li>
  
    <li><a href="/tags/devtools/">devtools</a><small>1</small></li>
  
    <li><a href="/tags/disqus/">disqus</a><small>1</small></li>
  
    <li><a href="/tags/escalabilidade/">escalabilidade</a><small>1</small></li>
  
    <li><a href="/tags/formularios/">formularios</a><small>1</small></li>
  
    <li><a href="/tags/functional-programming/">functional programming</a><small>2</small></li>
  
    <li><a href="/tags/funcoes/">funções</a><small>1</small></li>
  
    <li><a href="/tags/getmodule/">getmodule</a><small>1</small></li>
  
    <li><a href="/tags/git/">git</a><small>1</small></li>
  
    <li><a href="/tags/github/">github</a><small>1</small></li>
  
    <li><a href="/tags/gulpjs/">gulpjs</a><small>3</small></li>
  
    <li><a href="/tags/hexo/">hexo</a><small>1</small></li>
  
    <li><a href="/tags/html5/">html5</a><small>1</small></li>
  
    <li><a href="/tags/istanbul/">istanbul</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>1</small></li>
  
    <li><a href="/tags/markdown/">markdown</a><small>2</small></li>
  
    <li><a href="/tags/module-pattern/">module pattern</a><small>1</small></li>
  
    <li><a href="/tags/mutation-observer/">mutation observer</a><small>1</small></li>
  
    <li><a href="/tags/mvc/">mvc</a><small>1</small></li>
  
    <li><a href="/tags/nodejs/">nodejs</a><small>5</small></li>
  
    <li><a href="/tags/performance/">performance</a><small>1</small></li>
  
    <li><a href="/tags/pre-processadores/">pré-processadores</a><small>1</small></li>
  
    <li><a href="/tags/requirejs/">requirejs</a><small>1</small></li>
  
    <li><a href="/tags/rsync/">rsync</a><small>1</small></li>
  
    <li><a href="/tags/segredos-do-github/">segredos do github</a><small>12</small></li>
  
    <li><a href="/tags/serie-temas-wordpress/">serie temas wordpress</a><small>10</small></li>
  
    <li><a href="/tags/setinterval/">setInterval</a><small>1</small></li>
  
    <li><a href="/tags/settimeout/">setTimeout</a><small>1</small></li>
  
    <li><a href="/tags/sourcemaps/">sourcemaps</a><small>1</small></li>
  
    <li><a href="/tags/spam/">spam</a><small>1</small></li>
  
    <li><a href="/tags/ssh/">ssh</a><small>1</small></li>
  
    <li><a href="/tags/stylus/">stylus</a><small>1</small></li>
  
    <li><a href="/tags/task-runner/">task runner</a><small>1</small></li>
  
    <li><a href="/tags/tdd/">tdd</a><small>1</small></li>
  
    <li><a href="/tags/tema-wordpress/">tema wordpress</a><small>1</small></li>
  
    <li><a href="/tags/temporizadores/">temporizadores</a><small>1</small></li>
  
    <li><a href="/tags/tips/">tips</a><small>5</small></li>
  
    <li><a href="/tags/umd/">umd</a><small>1</small></li>
  
    <li><a href="/tags/void/">void</a><small>1</small></li>
  
    <li><a href="/tags/wordcamp/">wordcamp</a><small>1</small></li>
  
    <li><a href="/tags/workflow/">workflow</a><small>3</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 <a href="//plus.google.com/+FernandoDaciuk?rel=author" rel="author"  target="_blank">Fernando Daciuk</a>
  
</div>
<div class="clearfix"></div>
</footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/google-search.js"></script>
<script src="/js/modules/InfiniteScroll.js"></script>
<script src="/js/app.js" id="script-main" data-url="http://blog.da2k.com.br/2015/02/24/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-2/"></script>


<script type="text/javascript">
var disqus_shortname = 'blogda2k';
var disqus_url = 'http://blog.da2k.com.br/2015/02/24/wordpress-criando-um-formulario-de-contato-sem-plugin-parte-2/';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>